<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FPAS Login</title>
  <link rel="stylesheet" href="style.css">
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#38bdf8">
</head>
<body class="center">

<div class="login-card glass">
  <h2>FPAS Login</h2>

  <select id="role">
    <option value="admin">Admin</option>
    <option value="faculty">Faculty</option>
  </select>

  <input id="userid" placeholder="User ID">
  
  <div class="pass-box">
    <input id="password" type="password" placeholder="Password">
    <span onclick="togglePass()">üëÅ</span>
  </div>

  <div class="captcha">
    <span id="capText"></span>
    <input id="captcha" placeholder="Answer">
  </div>

  <button onclick="login()">Login</button>
</div>

<script src="dashboard.js"></script>
<script>
/* LOGIN LOGIC WITH DEFAULT USERS */
let users = JSON.parse(localStorage.getItem("users")) || {
  A001:{role:"admin",pass:"admin123"},
  A002:{role:"admin",pass:"admin123"},
  A003:{role:"admin",pass:"admin123"},
  F001:{role:"faculty",pass:"faculty123"},
  F002:{role:"faculty",pass:"faculty123"},
  F003:{role:"faculty",pass:"faculty123"},
  F004:{role:"faculty",pass:"faculty123"},
  F005:{role:"faculty",pass:"faculty123"},
  F006:{role:"faculty",pass:"faculty123"},
  F007:{role:"faculty",pass:"faculty123"}
};
localStorage.setItem("users", JSON.stringify(users));

let a = Math.floor(Math.random()*10), b=Math.floor(Math.random()*10);
document.getElementById("capText").innerText = `${a} + ${b} = ?`;

function togglePass(){
  const p = document.getElementById("password");
  p.type = p.type==="password"?"text":"password";
}

function login(){
  const id = document.getElementById("userid").value;
  const pass = document.getElementById("password").value;
  const role = document.getElementById("role").value;
  const cap = parseInt(document.getElementById("captcha").value);

  if(cap !== (a+b)) return alert("Captcha incorrect");

  const user = JSON.parse(localStorage.getItem("users"))[id];
  if(user && user.pass === pass && user.role === role){
    localStorage.setItem("user",id);
    localStorage.setItem("role",role);
    location.href = "dashboard.html";
  } else alert("Invalid credentials");
}

/* ---------- SERVICE WORKER REGISTRATION ---------- */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js")
    .then(reg => console.log("Service Worker Registered", reg))
    .catch(err => console.log("SW Registration Failed", err));
}
</script>
</body>
</html>
